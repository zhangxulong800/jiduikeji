{extend name="wap/default/base" /} {block name="resources"}
<link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/mall.css">
<link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/pre_foot.css">
<link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/goods_detail.css">
<script src="__TEMP__/{$style}/public/js/goods_product_else.js"></script><!-- 特别详情页面专用 -->
<script language="javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="__TEMP__/{$style}/public/js/jscommon.js" language="javascript" charset="gb2312"></script>
<script src="__TEMP__/{$style}/public/js/jquery.lazyload.js" type="text/javascript"></script>
<script>
	var APPMAIN = 'APP_MAIN';
	var shop_main='SHOP_MAIN';//外置JS调用
</script>
<style>
	.js-shelves {
		display: none;
	}
	.comment-type{
		margin-bottom: 50px;
	}
</style>
{/block}
{block name="goodsHead"}
<section class="head" style="display:none;">
	<a class="head_back" onclick="window.history.go(-1)" href="javascript:void(0)"><i class="icon-back"></i></a>
	<div class="head-title">{$shopname}</div>
</section>
{/block}
{/block}
{block name="main"}
<link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/scroll.css">
<link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/detail.css">
<link rel="stylesheet" type="text/css" href="__TEMP__/{$style}/public/css/components.css">
<script src="__TEMP__/{$style}/public/js/scroll.js" type="text/javascript"></script>
<script src="__TEMP__/{$style}/public/js/countdown.js" type="text/javascript"></script>
<style>
	a,li{border: none;-webkit-tap-highlight-color: rgba(0,0,0,0);-webkit-tap-highlight-color: transparent;outline: none;}
	.address-select{
		width: 30%;
		float: left;
		border: 1px solid #e5e5e5;
		height: 20px;
		line-height: 20px;
		margin: 5px 15px;
		margin-left: 0;
	}
	.shop_slider .bar_wrap{
		z-index:-1;
	}
	.buy_area{
		overflow: hidden;
		background: #FEFEFC;
		height: auto;
		padding:2% 0 0;
		margin: 0 auto;
	}
	.product-name-jplus {
		background: #FFF6FA;
		height: 30px;
		line-height: 30px;
		display: none;
	}
	.product-name-jplus span {
		padding: 0 5px;
		font-size: 12px;
		background: #F83271;
		color: #fff;
		margin: 5px 3%;
		display: block;
		float: left;
		line-height: 20px;
	}
	.product-name-jplus a {
		display: block;
		float: right;
		margin-right: 5px;
		color: #333;
		line-height: 30px;
	}
	.icon {
		width: 20px;
		height: 30px;
		display: block;
		float: right;
		position: relative;
	}
	.iconover::after {
		content: '';
		position: absolute;
		width: 7px;
		height: 7px;
		border-top: 1px solid #999;
		border-right: 1px solid #999;
		-webkit-transform: rotate(45deg);
		-moz-transform: rotate(45deg);
		-ms-transform: rotate(45deg);
		transform: rotate(45deg);
		top: 50%;
		right: 3px;
		margin-top: -4px;
	}
	.cf:before,.cf:after{display:table;line-height:0;content:"";}
	.cf:after{clear:both;}
	*.cf{zoom:1;}
	.detail_list li{
		font-size:13px;
		width: 45%;
		float: left;
		padding-top:6px;
	}
	.detail_list ul>li:nth-child(2n){
		margin-left:30px;
	}
	.ly-buton {
		padding: 0 22px;
		height: 30px;
		cursor: pointer;
		background: rgba(127,127,127,.1);
		border-radius: 15px;
		display:inline-block;
		margin-left: 10px;
		line-height: 30px;
	}
	.ly-buton.over {
		background-color: #FF0066;
		color: #fff;
	}
	.date{
		margin-top:6px;
	}
	.user_info{width: auto;}
	.face{
		display: inline-block;
		line-height: 32px;
		margin-right: 10px;
	}
	.name-box{
		display: inline-block;
	}
	.tablelist dl{
		float:initial;
		width: 100%;
	}
	.star_bg{
		width: 120px;
		height: 20px;
		position: relative;
		overflow: hidden;
		margin-top: 6px;
		padding-left: 10px;
		display: block;
	}
	.star {
		height: 100%;
		width: 24px;
		line-height: 6em;
		float: left;
		background: url(__TEMP__/{$style}/public/images/login/star.png) no-repeat center;
	}
	.star_1 {
		background: url(__TEMP__/{$style}/public/images/login/star_color.png) no-repeat center;
	}
	.excdetail-responsive-wrapper {
		display: flex;
		justify-content: space-between;
	}
	.alink-area {
		display: flex;
	}
</style>
<!-- 商品详情 -->
<section id="banner">
	<div class="shop_slider shop_slider_auto" data-tag="module-slider" data-height="320px">
		<div class="inner" data-tag="slider-warp" >
			<ul class="pic_list" data-tag="slider-list">
				{foreach name = "goods_detail['img_list']" item = 'img_list' key='key' }
				<li style="width: 320px;">
					<div>
						<img alt="图片" class="pp_init_img" src="__ROOT__/{$img_list.pic_cover_big}" />
					</div>
				</li>
				{/foreach}
			</ul>
		</div>
		<div class="bar_wrap">
			<ul class="bar" data-tag="slider-page">
				<li class="cur"></li>
				<li></li>
				<li></li>
			</ul>
		</div>
	</div>
</section>
<div class="buy_area">
	<div class="fn_wrap cf">
		<h1 class="title" id="itemName">{$goods_detail.goods_name}</h1>
		<a href="javascript:;" class="fr" id="showShareMask"><img src="__TEMP__/{$style}/public/images/share.png" width="24px"/></a>
	</div>
	<div class="price_wrap">
		<span class="tit" id="priceTitle"></span>
		<span id="duihuanPrice" class="price" price="{$goods_detail.price}" style="font-size:30px;margin-right:0;">
			{notempty name="$goods_detail.promotion_info"}<span style="font-size:12px;font-weight:normal">{$goods_detail.promotion_info}</span>{/notempty}&nbsp;<span style="font-size:14px;display:inline-block;vertical-align:middle;">通兑积分：</span>{$goods_detail.price*$goods_detail.zero_point_num}
		</span>
		<!--<span class="flag" id="priceDis" style="display: none"></span>-->
	</div>
	{if condition = "$discount_info neq ''"}
	{if condition = "count($discount_info['data']) > 0"}
	{volist name="$discount_info['data']" id="vo"}
	<div class="goods-header js-goods-header goods-activity clearfix">
		<input type="hidden" id="end_time"  value="{$vo.end_time}"/>
		<div class="goods-price">
			<em class="original-price">￥{$goods_detail.price}</em>
			<div class="font-size-12 overview-countdown js-activity-tips started " data-status="started">
				<div class="js-discount-time countdown" data-countdown="3542691">
					<label class="countdown-title" style="display: inline;">距结束仅剩:</label>
					<span class="c-red js-hour">00</span> 时
					<span class="c-red js-min">00</span> 分
					<span class="c-red js-sec">00</span> 秒
				</div>
			</div>
		</div>
	</div>
	{/volist}
	{/if}
	{/if}
	<hr class="with-margin-l" />
	<div class="product-name-jplus">

		{if condition="$goods_detail.max_buy>0"}
		<i style="color:#ff0000;font-size: 12px;padding: 3px;border-radius: 2px;">限购 X{$goods_detail.max_buy}</i></span>
		{/if}
		{if condition = "$goods_detail['jplus_level'] eq '0'"}
		<a href="/wap/member/memberCenter">开通会员 <i class="icon iconover"></i></a>
		{/if}
		<!-- 			<span class="price_postage_tit">运费：{$goods_detail['shipping_fee_name']}</span> -->
	</div>
</div>
<hr class="with-margin-l" />
<hr class="divider-line" />
{if condition = "$goods_detail['mansong_name'] neq ''"}
<div class="price_postage">
	<span class="price_postage_tit js-reduced-send single"><i style="color: #fff;font-size: 12px;padding: 3px;background: #f44;border-radius: 2px;">满减</i>&nbsp;{$goods_detail['mansong_name']}</span>
</div>
<hr class="with-margin-l" />
<hr class="divider-line" />
{/if}

{if condition = "$goods_detail['give_point'] neq 0"}
<div class="price_postage">
	<span class="price_postage_tit"><i class="fa fa-database" style="color: #F44;margin-right: 5px;"></i>赠送积分<span style="color:#F44;padding:0;">{$goods_detail['give_point']}</span>分</span>
</div>
<hr class="with-margin-l" />
{/if}
<div class="statistics">
	<div class="app-field clearfix">
		<div class="control-group">
			<div class="custom-store block-item">
				<a class="custom-store-link clearfix" href="APP_MAIN/shop/index?shop_id={$goods_detail.shop_id}">
					<div class="custom-store-img"></div>
					<div class="custom-store-name">{$goods_detail.shop_name}</div>
					<div class="custom-store-enter">进入店铺</div>
				</a>
			</div>
			<div class="component-border"></div>
		</div>
		<div class="sort">
			<i class="sort-handler"></i>
		</div>
	</div>
	<hr class="with-margin-l" />

	<div class="price_postage">
			<span class="price_postage_tit">
				<img src="__TEMP__/{$style}/public/images/pro_detail_shop.jpg"/>
				<span style="font-size: 12px;" >企业认证</span>
				<img src="__TEMP__/{$style}/public/images/pro_detail_shop.jpg"/>
				<span >担保交易</span>
				<img src="__TEMP__/{$style}/public/images/pro_detail_shop.jpg"/>
				<span class="rz-name font-size-12 c-gray-darker">线下门店</span>
			</span>
	</div>

</div>

<div class="mod_tab_wrap">
	<div class="mod_tab" id="detailTab">
		<span onclick="showProperty(this,1)" class="cur">商品详情</span>
		<span onclick="showProperty(this,2)" >商品属性</span>
		<span onclick="showProperty(this,3)">商品评价</span>
	</div>
</div>

<!-- 商品详情 -->
<div class="detail_info_wrap" id="p-detail">
	<div class="detail_list" id="content">{$goods_detail.description}</div>
</div>
<!-- 商品属性 -->
<div class="detail_info_wrap p-attribute" id="p-attribute" style="display:none;" >
	{if condition = "count($goods_detail['goods_attribute_list']) gt 0"}
	<ul class="attribute-ul">
		{foreach $goods_detail["goods_attribute_list"] as $vo}
		<li>
			<em>{$vo.attr_value}：</em>
			<span id="goods_attr_" title="{$vo.attr_value_name}" class="goods-attr-value">{$vo.attr_value_name}</span>
		</li>
		{/foreach}
	</ul>
	{/if}
</div>

<!-- 商品评论 -->
<div class="comment-type" id="productproperty" style="display:none;">
	<ul class="tab-nav">
		<li class="productproperty-list current" data-type="0" >全部<em>({$evaluates_count['evaluate_count']})</em></li>
		<li class="productproperty-list" data-type="4"  >图片 <em>({$evaluates_count['imgs_count']})</em></li>
		<li class="productproperty-list" data-type="1" >好评 <em>({$evaluates_count['praise_count']})</em></li>
		<li class="productproperty-list" data-type="2" >中评 <em>({$evaluates_count['center_count']})</em></li>
		<li class="productproperty-list" data-type="3" > 差评 <em>({$evaluates_count['bad_count']})</em></li>
	</ul>
	<!-- 评论展示 -->
	<div id="comment_content">
		<div class="comment-con"></div>
	</div>
</div>

{include file="wap/default/controlCopyRight"}
<!-- 弹出框 -->
<div class="success-tip-line" id="success_tip_line" style="display: none;">成功加入购物车！</div>
<div class="mask" id="mask" style="display: none;"></div>
<span id="addcart_way" style="display: none;"><i></i></span>
<div class="s-buy" id="s_buy">
	<div class="popup"  id="popup" style="-webkit-border-radius:3px;-moz-border-radius:3px;-o-border-radius:3px;border-radius:3px;display: none"></div>
	<div class="dersking">
		<ul class="s-buy-ul">
			<li class="s-buy-pro">
					<span class="pro-img">
						<input type="hidden" id="default_img" value="{$goods_detail['img_list'][0]['pic_id']}" />
						<img src="__ROOT__/{$goods_detail['img_list'][0]['pic_cover_small']}" >
					</span>
				<div class="pro-info">
					<p class="name" >{$goods_detail.goods_name}</p>
					<p class="pro-price" id="price2">
						<!--
							￥ {$goods_detail.promotion_price}
							{if condition="$goods_detail.point_exchange_type==1 && $goods_detail.point_exchange>0"}
							<span style="font-size:16px;display: inline-block;vertical-align: middle;">+{$goods_detail.point_exchange}积分</span>
							{/if}  -->
					</p>
				</div>
				<i class="icon-close" id="icon_close"></i>
			</li>
		</ul>
		<hr class="with-margin-l" />
		<ul class="s-buy-ul specification" id="specification">
			{foreach name="goods_detail['spec_list']" item="spec" key="k"}
			<li class="s-buy-li" >
				<div class="left">{$spec.spec_name}：</div>
				<div class="right" name="specvals" >
					{foreach name="spec['value']" item="spec_value"}
					{if condition="$spec_value['spec_id'] eq $spec['spec_id']"}
					<button class="select" name="Span{$k}" id="{$spec_value.spec_id}:{$spec_value.spec_value_id}" onclick="change(this);">
						{$spec_value.spec_value_name}
					</button>
					{/if}
					{/foreach}
				</div>
			</li>
			<hr class="with-margin-l" />
			{/foreach}
			{foreach name="goods_detail['sku_list']" item="pro_skus" key="k"}
			<input type="hidden" id="goods_sku{$k}" value="{$pro_skus.attr_value_items}" stock="{$pro_skus.stock}" price="{$pro_skus.price*$goods_detail.zero_point_num}" skuid="{$pro_skus.sku_id}" skuname="{$pro_skus.sku_name}" class="sku-array">
			{/foreach}
			<input type="hidden" id="goods_sku_num" value="100">
			<li class="s-buy-li">
				<div class="left" style="float:left;">购买数量：</div>
				<div class="right">
					<!--<span class="reduce quantity-minus-disabled">-</span>-->
					<input class="number" name="quantity" disabled autocomplete="off" value="1" min="1" max="{$goods_detail.stock}" id="num" />
					<!--<span class="add">+</span>-->
				</div>
				<span style="display: inline-block;margin-top:5px;color:#333;" id="Stock">剩余{$goods_detail.stock}件</span>
				{if condition="$type>0"}
				<div id="firstone" style="width:100%;margin-top:5px;color:#F73232;">充值购物价格的{$goods_detail['first_free_num']}倍金额即可免费领取该商品</div >
				<div id="firsttwo" style="width:100%;margin-top:5px;color:#000000;">充值金额:￥<input style="border:none;" readonly="readonly" id="chongzhi" value="{$goods_detail['market_price']*$goods_detail['first_free_num']}"></div>
				{/if}
				{if condition ="$goods_detail['max_buy'] neq '0' AND $goods_detail['max_buy'] neq -1"}
				<span style="display: inline-block;margin-top:5px;color:#333;">限购{$goods_detail['max_buy']}件</span>
				{/if}
			</li>
		</ul>
		<ul class="s-buy-ul">
			<li class="s-buy-btn">
				<a class="btn" id="submit_ok" tag="buyBtn1">确定</a>
				<input id="hiddPDetailID" type="hidden" value="{$goods_detail.goods_id}"/>
				<input id="hiddSkuId" type="hidden" />
				<input id="hiddSkuName" type="hidden" />
				<input id="hiddSkuprice" type="hidden" />
				<input id="hiddStock" type="hidden" value="{$goods_detail.stock}"/>
				<input type="hidden" id="hidden_shop_name" value="{$goods_detail.shop_name}"/>
				<input type="hidden" id="hidden_shop_id" value="{$goods_detail.shop_id}"/>
				<input type="hidden" id="is_sale" value="{$goods_detail.state}" />
				<input type="hidden" id="goods_id" value="{$goods_detail.goods_id}" />
				<input type="hidden" id="code" value="{$goods_detail.code}" />
				<input type="hidden" id="max_buy" value="{$goods_detail.max_buy}" />
				<input type="hidden" id="hidden_current_num" value="{$num}" />
				<input type="hidden" id="hidden_exc" value="1" /> <!--0元兑换专用 -->
			</li>
		</ul>
	</div>
</div>
<div class="share-mask-container">
	<div class="shareimg01">
		<img src="__TEMP__/{$style}/public/images/newIndex/newMember/shareImg02.png">
	</div>
	<div class="shareimg02">
		<img src="__TEMP__/{$style}/public/images/newIndex/newMember/shareImg01.png">
	</div>

</div>
<script type="text/javascript">
	$(function () {
		countDown();//计时器
		$("#content ul").addClass('cf');
		//分享
		$.ajax({
			type:"post",
			data : {"shop_id" : "{$shop_id}" , "flag" : "goods" , "goods_id" : "{$goods_id}"},
			url : "APP_MAIN/goods/getShareContents",
			success : function(data){
				console.log('-----',data);
				localStorage.setItem("$infoData",JSON.stringify(data));
				{include file='wap/default/shareContents'/}
			}
		});


		$("#showShareMask").on('click',function () {
			$(".share-mask-container").show();
		})
		$(".share-mask-container").on('click',function () {
			$(".share-mask-container").hide();
		})



		$(".ly-buton").click(function(){
			$(this).parent().find(".ly-buton").removeClass("over");
			$(this).addClass("over");
		});
	});

	//商品评价
	$(".comment-type li").click(function() {
		var type = $(this).data("type");
		var target = $(this);
		$(".comment-type").find("li").removeClass("current");
		$(".comment-type").find("i").removeClass("cur");
		$(target).addClass("current");
		$(target).children().addClass("cur");
		GetDataList();
	})


	function showProperty(sobj,type){
		$("#detailTab span").removeClass("cur");
		$(sobj).addClass("cur");
		if(type==1){
			$("#productproperty").hide();
			$("#p-detail").show();
			$("#p-attribute").hide();
		}else if(type == 2){
			$("#productproperty").hide();
			$("#p-detail").hide();
			$("#p-attribute").show();
		}else{
			$("#productproperty").show();
			$("#p-detail").hide();
			$("#p-attribute").hide();
			GetDataList();
		}
	}

	/**
	 * 分页显示
	 * @param {Object} pageindex
	 */
	function GetDataList(){
		var commentsType=$(".comment-type li.current").attr('data-type');
		$.ajax({
			type:"post",
			url:"APP_MAIN/Goods/getGoodsComments",
			data:{'comments_type' : commentsType, "goods_id" : $("#goods_id").val() },
			dataType:'json',
			success:function(data){
				var listhtml='';
				if(data['data'].length==0){
					$('.comment-con').html('<div class="tip-box"><i class="tip-icon"></i><div class="tip-text">还没有任何评价哦</div></div>');
					$('#pagination').hide();
					return false;
				}
				for(var i=0;i<data['data'].length;i++){
					var dataitem=data['data'][i];
					var member_name=dataitem['member_name'];
					member_name=dataitem['is_anonymous']==1?member_name.replace(member_name.substring(1,member_name.length),'***')+'(匿名)':member_name;
					listhtml+=' <div class="tablelist" style="border-bottom: 1px solid #e5e5e5;margin-bottom: 10px;">'
							+'<div class="cf">'
							+'<div class="user_info" style="margin-right:10px;">'
							+'<div class="face"><img src="__TEMP__/{$style}/public/images/default_user_portrait_0.png" style="width:35px;border-radius: 50%;"/></div>'
							+'<div class="name-box">'+member_name+'</div>'
							+'</div>'
					listhtml+='<div class="star_bg">'
					if(dataitem.scores>0){
						for(var j=0;j<dataitem.scores;j++){
							listhtml+='<div  class="star star_1"></div>'
						}
					}
					if(dataitem.scores<5 && dataitem.scores != 0){
						for(var j=0;j<5 - dataitem.scores;j++){
							listhtml+='<div  class="star"></div>'
						}
					}
					listhtml+='</div>'
							+'</div>'
							+'<div class="date"><span>'+dataitem['addtime']+'</span> <span></span></div>'
							+'<dl>'
							+'<dd>'+dataitem['content']+'</dd>'
					if(dataitem['image']!=''){
						var imgs_arr=dataitem['image'].split(',');
						listhtml+='<dd style="margin:5px 0;">'
						for(var key in imgs_arr){
							listhtml+='<img src="__UPLOAD__/'+imgs_arr[key]+'" alt="" style="max-width:10%"/>';
						}
						listhtml+='</dd>';
						listhtml+='<dd class="photo-viewer"></dd>'
					}
					listhtml+='</dl>';
					if(dataitem['again_content']!=''){

						listhtml+='<div style="margin-left:-1px;float:right;margin-top: 9px;width:75%;">追加评价：</div>'
								+'<dl>'
								+'<div style="width: 26%;margin-right: 10px;height:auto;float: left;"></div>'
								+'<dd>'+dataitem['again_content']+'</dd>'
						if(dataitem['again_image']!=''){
							var imgs_arr=dataitem['again_image'].split(',');
							listhtml+='<dd>'
							for(var key in imgs_arr){
								listhtml+='<img src="__UPLOAD__/'+imgs_arr[key]+'" alt="" />';
							}
							listhtml+='</dd>';
						}
						listhtml+='<div class="date"><span>'+dataitem['again_addtime']+'</span> <span></span></div>';
						listhtml+='</dl>';
					}
					listhtml+='</div>';
				}
				$(".comment-con").html(listhtml);
			}
		});
	}
</script>
{include file='wap/default/share'/}
{/block}
{block name="bottom"}

<div class="js-bottom-opts bottom-fix" id="purchase">
	<input type="hidden" value="{$buy_arr.num}" id="buy_num"/>
	<input type="hidden" value="{$buy_arr.message}" id="buy_messege"/>
	<div class="responsive-wrapper excdetail-responsive-wrapper">
		<div class="alink-area">
			<a id="global-cart" href="APP_MAIN/goods/cart" class="new-btn buy-cart {if condition="$carcount>0"}buy-cart-msg{/if} ">
				<i class="iconfont icon-shopping-cart"></i>
				<span class="desc">购物车</span>
			</a>
			<a href="/wap/member/customer" class="service new-btn buy-cart">客服</a>
			<a href="APP_MAIN/shop/index?shop_id={$goods_detail.shop_id}" class="shops new-btn buy-cart">商铺</a>
			<a href="javascript:void(0);"{if condition="$is_member_fav_goods>0"}class="love new-btn buy-cart love_but"{else/}class="love new-btn buy-cart"{/if}  onclick="collectionGoods({$goods_detail.goods_id},'goods','{$goods_detail.goods_name}',this,false)">
			<i data-log-id="{$is_member_fav_goods}"></i>
			<span>{if condition="$is_member_fav_goods>0"}已收藏
													{else/}收藏{/if}</span>
			</a>
		</div>

		<div class="big-btn-2-1">
			<a href="javascript:;" class="big-btn red-btn" style="width:170px;display: flex;align-items: center;justify-content: center;" id="buyBtn1">立即兑换</a>
		</div>
	</div>
</div>
<div class="btn_wrap btn_wrap_static btn_wrap_nocart no-server js-shelves">
	<div class="product-status">该商品已下架</div>
</div>
<input type="hidden" value="{$uid}" id="uid"/>
<script>
	$(function(){
		var url = location.search; //获取url中"?"符后的字串
		var theRequest = new Object();
		if(url.indexOf("?") != -1) {
			var str = url.substr(1);
			strs = str.split("&");
			for(var i = 0; i < strs.length; i ++) {
				theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
			}
		}
		if(theRequest.shop_group_id != null || theRequest.shop_group_id != undefined){
			$('#purchase').remove();
		}else{
			$('#purchase2').remove();
		}
		if(!$('#mask').is(':hidden')){
			$('body').css({
				"overflow-y":"hidden"
			});
		}else{
			$('body').css({
				"overflow-y":"auto"
			});
		}
	})
</script>
{/block}